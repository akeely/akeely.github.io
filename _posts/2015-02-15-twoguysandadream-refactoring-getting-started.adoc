---
layout: post
title: "Refactoring Two Guys and a Dream: Getting Started"
date: 2015-02-13
comments: true
sharing: true
categories: [Refactoring, TwoGuysAndADream]
tags: [TwoGuysAndADream, Refactoring]
---

[NOTE]
This is a post in a series about Refactoring TwoGuysAndADream.com. To see all posts in this series, go link:/tags/TwoGuysAndADream[here].

****
See the code changes for this post: link:https://github.com/akeely/twoguysandadream/compare/5d63d83e38d137883a31eadeafe0bb6f6132c3c9...45a43c9d44059d5c9756f95b286f91d7e0333f3f[Code changes].
****

= What to Replace

To get started on refactoring, I wanted to isolate a single piece of functionality to replace. From monitoring the load during the last draft (and our knowledge of the site), I was able to isolate a single request that caused most of our performance problems.

During an auction, the auction board is refreshed every second. The data is collected by making a request to link:https://github.com/akeely/twoguysandadream/blob/0904a0aefbcd47f24fd26e2aedfce9c424b1f3d4/cgi-bin/fantasy/checkBids.pl[`checkBids.pl`]. With an average of 12 users during an auction, we expect about 12 requests per second. For a modern web application, this is not much, but for an inefficient perl script running on minimal hardware, it caused load issues.

= Isolating the Request

While the auction board user interface is generated by Perl CGI scripts, the content is mostly static. I was able to extract static link:https://github.com/akeely/twoguysandadream/blob/454fc4e457870798ec6545c5d3ca60d3e53d6239/public/auction.html[HTML] and link:https://github.com/akeely/twoguysandadream/blob/454fc4e457870798ec6545c5d3ca60d3e53d6239/public/all_js.js[JavaScript] files generated by the CGI scripts using browser tools. I made a link:https://github.com/akeely/twoguysandadream/blob/454fc4e457870798ec6545c5d3ca60d3e53d6239/public/all_js.js#L182[small change] to the JavaScript file so that it would request data from a new endpoint rather than the CGI script.

I also made a request to the existing `checkBids.pl` CGI script to determine the structure of the JSON response, and saved it to a link:https://github.com/akeely/twoguysandadream/tree/454fc4e457870798ec6545c5d3ca60d3e53d6239/src/main/resources/checkBids.json[file]. (I used a test league and set up the league state appropriately to ensure I would cover most of the response content as it would be seen during a draft).

= Creating a Prototype

Once the interface was ready, I created a new Spring Boot project to hold the refactored code. In that project, I created a link:https://github.com/akeely/twoguysandadream/tree/45a43c9d44059d5c9756f95b286f91d7e0333f3f/src/main/java/com/twoguysandadream/resources/legacy/AuctionBoard.java[simple controller] that served the static JSON response I generated in the previous step.

With these pieces in place, I am now able to start the application and see that the pieces  fit together:

image::/assets/auction-prototype.png[Screenshot of prototype]
